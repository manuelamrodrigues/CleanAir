<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CleanAir | Dashboard </title>
    <link rel="stylesheet" href="../css/dashboardStyle.css">
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <link
        href="https://fonts.googleapis.com/css2?family=Teachers:ital,wght@0,400..800;1,400..800&family=Ubuntu+Sans:ital,wght@0,100..800;1,100..800&family=Ubuntu:ital,wght@0,300;0,400;0,500;0,700;1,300;1,400;1,500;1,700&display=swap">

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>
    <header>
        <nav class="nav-bar">

            <div class="logo">
                <a href="../index.html"><img src="../assets/imgs/logo.png" alt="logo"></a>
            </div>

            <div class="nav-list">
                <ul>
                    <li class="nav-item"> <a href="#mudancas" class="nav-link">Mudanças climáticas </a></li>
                    <li class="nav-item"> <a href="#impactos" class="nav-link">Impactos </a></li>
                    <li class="nav-item"> <a href="#doencas" class="nav-link">Doenças </a></li>
                    <li class="nav-item"> <a href="#combater" class="nav-link">Mudanças comportamentais </a></li>
                    <li class="nav-item"> <a href="#ongs" class="nav-link">Outras ONGs </a></li>
                </ul>
            </div>

            <!-- <div class="login-button">
                <i class='bx bx-exit'></i>
                <li class="nav-item"> <a href="login.html" class="nav-link">Sair </a></li>
            </div> -->
        </nav>
    </header>

    <div class="maior">




        <div class="mudancas" id="mudancas">
            <h1>Afinal, o que são mudanças climáticas?</h1>
            <span id="textoMudancas">Segundo o Conselho Nacional do Meio Ambiente, trata-se de quaisquer alterações no
                meio ambiente resultantes da atividade humana que afetam:
                • A saúde, segurança ou bem-estar da população;
                • As atividades sociais e econômicas;
                • Os seres vivos e as condições estéticas e sanitárias do meio ambiente.
            </span>
        </div>

        <div class="impactos" id="impactos">

            <div class="left-topics">
                <span>
                    Aumento das secas <br><br>
                    Tempestades severas <br><br>
                    Contamina e degrada o solo
                </span>
            </div>

            <div class="impactosTitulo">
                <h1>Como impactam os seres vivos?</h1>

                <div class="imgImpacto">
                    <img src="../assets/imgs/globoFogo.png" alt="" id="img1">
                </div>

            </div>

            <!-- <div class="imgImpacto">
                <img src="./imgs/globoFogo.png" alt="" id="img1">
            </div> -->

            <div class="right-topics">
                <span>
                    Aumento de doenças <br><br>
                    Perda de espécies <br><br>
                    Pobreza e deslocamento
                </span>

            </div>
        </div>





        <div class="grafico" id="doencas">

            <div class="container">
                <div class="select-btn">
                    <span class="btn-text">Devido as alterações no meio ambiente, algumas doenças, principalmente
                        aquelas transmitidas
                        por mosquitos, podem aumentar. Vote em qual doença você já enfretou esse ano: </span>
                </div>

                <ul class="list-itens">

                    <select name="selectDoencas" id="selectDoencas">
                        <option value="#">Selecione uma opção</option>
                        <option value="dengue">Dengue</option>
                        <option value="leishmaniose">Leishmaniose</option>
                        <option value="malaria">Malária</option>
                        <option value="febre">Febre amarela</option>
                    </select>

                </ul>
                <button onclick="cadastrar()">Confirmar</button>
            </div>

            <div class="graficoTitulo">
                <h1>Doenças potencializadas pelas mudanças climáticas</h1>
            </div>


            <div class="graficoTempoReal" id="graficos">
                <canvas id="myChartCanvas"></canvas>
            </div>

        </div>




        <div class="combater" id="combater">
            <h1> 3 mudanças comportamentais para mitigar os impactos</h1>

            <div class="card-container">

                <div class="card">
                    <div class="card-content">
                        <h3>Diminua o uso de combustíveis fósseis </h3>
                        <p>Dê preferência ao uso de biocombustíveis e etanol ou use transportes públicos, faça caminhada
                            e ande de bicicleta. </p>
                    </div>
                </div>

                <div class="card">
                    <div class="card-content">
                        <h3>Não use produtos com gás CFC </h3>
                        <p>Geralmente encontrado em aerossóis ou produtos de refrigeração, esse gás costuma corroer a
                            camada de ozônio responsável por proteger a terra de raios ultravioletas.</p>
                    </div>
                </div>

                <div class="card">
                    <div class="card-content">
                        <h3>Economize energia </h3>
                        <p>Dê preferência ao uso de fontes de energia limpa e renováveis. Invista em eficiência
                            energética, ou seja, otimize processos para evitar desperdícios.</p>
                    </div>
                </div>
            </div>
        </div>





        <div class="outrasONGs" id="ongs">
            <div class="imgs-left">
                <a href="https://ipam.org.br/pt/"><img src="../assets/imgs/ipamLogo.png" alt="IPAM logo" id="img1"></a>
                <a href="https://www.oxfam.org.br/"><img src="../assets/imgs/oxfamLogo.png" alt="OXAM logo"
                        id="img2"></a>
            </div>

            <div class="textos">
                <h1>Conheça outras ONG's que apoiam a causa.</h1>
                <h1>Juntos fazemos a diferença!</h1>
            </div>

            <div class="imgs-right">
                <a href="https://www.sosma.org.br/"><img src="../assets/imgs/sos2.png" alt="SOS MA logo" id="img3"></a>
                <a href="https://www.tnc.org.br/"><img src="../assets/imgs/tncLogo.png" alt="TNC logo" id="img4"></a>
            </div>
        </div>

    </div>




    <footer>
        <div id="footer_content">
            <div id="footer_contacts">
                <h1>CleanAir</h1>
                <p>Juntos fazemos a diferença!</p>

                <div id="footer_socialMedia">
                    <a href="#" class="footer-link" id="instagram">
                        <i class='bx bxl-instagram-alt'></i>
                    </a>
                    <a href="#" class="footer-link" id="facebook">
                        <i class='bx bxl-facebook-circle'></i>
                    </a>
                    <a href="https://github.com/manuelamrodrigues/CleanAir" class="footer-link" id="github">
                        <i class='bx bxl-github'></i>
                    </a>
                </div>
            </div>

            <ul class="footer_list">
                <li>
                    <h3>Explorar</h3>
                </li>
                <li>
                    <a href="#mudancas" class="footer-link">Mudanças climáticas</a>
                </li>
                <li>
                    <a href="#impactos" class="footer-link">Impactos</a>
                </li>
                <li>
                    <a href="#doencas" class="footer-link">Doenças</a>
                </li>
                <li>
                    <a href="#combater" class="footer-link">Mudanças comportamentais</a>
                </li>
                <li>
                    <a href="#ongs" class="footer-link">Outras ONGs</a>
                </li>
            </ul>

            <div id="footer_copyright">
                <p>Todos os direitos reservados <i class='bx bx-copyright'></i> 2024</p>
                <p>Desenvolvido por Manuela Monteiro</p>
            </div>
        </div>
    </footer>



    </div> <!-- fechando a maior -->

</body>

</html>
<script>
    var usuarios = [];
    var doencas = [];
    var contagemDoencas = [];
    let proximaAtualizacao;

    function cadastrar() {
        // aguardar();

        //Recupere o valor da nova input pelo nome do id
        // Agora vá para o método fetch logo abaixo
        var idUsuarioVar = sessionStorage.ID_USUARIO;
        var selectDoencasVar = selectDoencas.value;
        var nomeDoencaVar = selectDoencasVar;
        // var emailVar = email_input.value;
        // var senhaVar = senha_input.value;
        // var confirmacaoSenhaVar = confirmacao_senha_input.value;
        // var empresaVar = listaEmpresas.value
        if (
            selectDoencasVar == "#"
            //   ||
            //   emailVar == "" ||
            //   senhaVar == "" ||
            //   confirmacaoSenhaVar == "" ||
            //   empresaVar == ""
        ) {
            alert("Selecione alguma opção")

            cardErro.style.display = "block";
            mensagem_erro.innerHTML =
                "(Mensagem de erro para todos os campos em branco)";


            finalizarAguardar();
            return false;
        } else {
            //   setInterval(sumirMensagem, 5000);
        }

        // Enviando o valor da nova input
        fetch("/novo/cadastrar", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify({
                // crie um atributo que recebe o valor recuperado aqui
                // Agora vá para o arquivo routes/usuario.js
                idUsuarioServer: idUsuarioVar,
                nomeDoencaServer: nomeDoencaVar
                // emailServer: emailVar,
                // senhaServer: senhaVar,
                // empresaServer: empresaVar
            }),
        })
            .then(function (resposta) {
                console.log("resposta: ", resposta);

                if (resposta.ok) {
                    //   cardErro.style.display = "block";

                    mensagem_erro.innerHTML =
                        "Cadastro realizado com sucesso! Redirecionando para tela de Login...";


                    setTimeout(() => {
                        window.location = "login.html";
                    }, "2000");

                    limparFormulario();
                    finalizarAguardar();
                } else {
                    throw "Houve um erro ao tentar realizar o cadastro!";
                }
            })
            .catch(function (resposta) {
                console.log(`#ERRO: ${resposta}`);
                // finalizarAguardar();
            });

        return false;
    }

    //   function listar() {
    //     fetch("/empresas/listar", {
    //       method: "GET",
    //     })
    //       .then(function (resposta) {
    //         resposta.json().then((empresas) => {
    //           empresas.forEach((empresa) => {
    //             listaEmpresas.innerHTML += `<option value='${empresa.id}'>${empresa.cnpj}</option>`;
    //           });
    //         });
    //       })
    //       .catch(function (resposta) {
    //         console.log(`#ERRO: ${resposta}`);
    //       });
    //   }

    //   function sumirMensagem() {
    //     cardErro.style.display = "none";
    //   }

    // O gráfico é construído com três funções:
    // 1. obterDadosGrafico -> Traz dados do Banco de Dados para montar o gráfico da primeira vez
    // 2. plotarGrafico -> Monta o gráfico com os dados trazidos e exibe em tela
    // 3. atualizarGrafico -> Atualiza o gráfico, trazendo novamente dados do Banco

    // Esta função *obterDadosGrafico* busca os últimos dados inseridos em tabela de medidas.
    // para, quando carregar o gráfico da primeira vez, já trazer com vários dados.
    // A função *obterDadosGrafico* também invoca a função *plotarGrafico*

    //     Se quiser alterar a busca, ajuste as regras de negócio em src/controllers
    //     Para ajustar o "select", ajuste o comando sql em src/models
    function obterDadosGrafico() {
        if (proximaAtualizacao !== undefined) {
            clearTimeout(proximaAtualizacao);
        }

        fetch(`/novo/ultimas/4`, { cache: 'no-store' })
            .then(function (response) {
                if (response.ok) {
                    response.json()
                        .then(json => {
                            usuarios = [];
                            doencas = [];
                            for (var i = 0; i < json.length; i++) {
                                usuarios.push(json[i].idUsuario);
                                doencas.push(json[i].idDoenca);
                                contagemDoencas.push(doencas);
                            }
                            plotarGrafico(doencas, contagemDoencas);
                        });
                } else {
                    console.error('Nenhum dado encontrado ou erro na API');
                }
            })
            .catch(function (error) {
                console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
            });
    }

    // Plotar o gráfico com os dados obtidos
    function plotarGrafico() {
        const ctx = document.getElementById('myChartCanvas').getContext('2d');
        const data = {
            labels: doencas,
            datasets: [{
                label: 'Doenças por usuários',
                data: usuarios,
                borderColor: '#633062',
                backgroundColor: '#633062',
                tension: 0.1
            }]
        };
        const config = {
            type: 'bar',
            data: data,
        };
        new Chart(ctx, config);
    }

    // Atualizar o gráfico periodicamente
    window.onload = function () {
        obterDadosGrafico();

        setInterval(obterDadosGrafico, 300000);
    };



</script>